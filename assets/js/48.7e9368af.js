(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{406:function(s,t,a){"use strict";a.r(t);var n=a(45),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"浅谈preflight-request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浅谈preflight-request"}},[s._v("#")]),s._v(" 浅谈preflight-request")]),s._v(" "),a("h4",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("有时候我们在调用后台接口的时候，会请求两次，如下图的")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s4.ax1x.com/2022/02/16/HWccE8.png",alt:"HWccE8.png"}}),s._v("\n其实第一次发送的就是preflight request(预检请求)，那么这篇文章将讲一下，为什么要发预检请求，什么时候会发预检请求，预检请求都做了什么")]),s._v(" "),a("h4",{attrs:{id:"一-为什么要发预检请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-为什么要发预检请求"}},[s._v("#")]),s._v(" 一. 为什么要发预检请求")]),s._v(" "),a("p",[s._v("我们都知道浏览器的同源策略，就是出于安全考虑，浏览器会限制从脚本发起的跨域HTTP请求，像XMLHttpRequest和Fetch都遵循同源策略。")]),s._v(" "),a("p",[s._v("1、浏览器限制发起跨域请求"),a("br"),s._v("\n2、跨域请求可以正常发起，但是返回的结果被浏览器拦截了")]),s._v(" "),a("p",[s._v("一般浏览器都是第二种方式限制跨域请求，那就是说请求已到达服务器，并有可能对数据库里的数据进行了操作，但是返回的结果被浏览器拦截了，那么我们就获取不到返回结果，这是一次失败的请求，但是可能对数据库里的数据产生了影响。")]),s._v(" "),a("p",[s._v("为了防止这种情况的发生，规范要求，对这种可能对服务器数据产生副作用的HTTP请求方法，浏览器必须先使用OPTIONS方法发起一个预检请求，从而获知服务器是否允许该跨域请求：如果允许，就发送带数据的真实请求；如果不允许，则阻止发送带数据的真实请求。")]),s._v(" "),a("h4",{attrs:{id:"二-什么时候发预检请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-什么时候发预检请求"}},[s._v("#")]),s._v(" 二. 什么时候发预检请求")]),s._v(" "),a("p",[s._v("HTTP请求包括： 简单请求 和 需预检的请求")]),s._v(" "),a("h5",{attrs:{id:"_1-简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-简单请求"}},[s._v("#")]),s._v(" 1. 简单请求")]),s._v(" "),a("p",[s._v("简单请求不会触发CORS预检请求，“简属于\n单请求”术语并不属于Fetch(其中定义了CORS)规范。\n若满足所有下述条件，则该请求可视为“简单请求”：")]),s._v(" "),a("ul",[a("li",[s._v("使用下列方法之一：")]),s._v(" "),a("li",[s._v("GET")]),s._v(" "),a("li",[s._v("HEAD")]),s._v(" "),a("li",[s._v("POST")]),s._v(" "),a("li",[s._v("Content-Type: (仅当POST方法的Content-Type值等于下列之一才算做简单需求)")]),s._v(" "),a("li",[s._v("text/plain")]),s._v(" "),a("li",[s._v("multipart/form-data")]),s._v(" "),a("li",[s._v("application/x-www-form-urlencoded")])]),s._v(" "),a("blockquote",[a("p",[s._v("注意: WebKit Nightly 和 Safari Technology Preview 为Accept\n, Accept-Language\n, 和 Content-Language\n首部字段的值添加了额外的限制。如果这些首部字段的值是“非标准”的，WebKit/Safari 就不会将这些请求视为“简单请求”。WebKit/Safari 并没有在文档中列出哪些值是“非标准”的，不过我们可以在这里找到相关讨论：Require preflight for non-standard CORS-safelisted request headers Accept, Accept-Language, and Content-Language, Allow commas in Accept, Accept-Language, and Content-Language request headers for simple CORS, and Switch to a blacklist model for restricted Accept headers in simple CORS requests。其它浏览器并不支持这些额外的限制，因为它们不属于规范的一部分。")])]),s._v(" "),a("h5",{attrs:{id:"_2-需预检的请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-需预检的请求"}},[s._v("#")]),s._v(" 2.需预检的请求")]),s._v(" "),a("p",[s._v("“需预检的请求”要求必须首先使用OPTIONS方法发起一个预检请求到服务区，以获知服务器是否允许该实际请求。“预检请求”的使用，可以避免跨域请求对服务器的用户数据产生未预期的影响。")]),s._v(" "),a("p",[s._v("当请求满足下述任一条件时，即应首先发送预检请求：")]),s._v(" "),a("p",[s._v("使用了下面任一 HTTP 方法：")]),s._v(" "),a("ul",[a("li",[s._v("PUT")]),s._v(" "),a("li",[s._v("DELETE")]),s._v(" "),a("li",[s._v("CONNECT")]),s._v(" "),a("li",[s._v("OPTIONS")]),s._v(" "),a("li",[s._v("TRACE")]),s._v(" "),a("li",[s._v("PATCH")])]),s._v(" "),a("p",[s._v("人为设置了对 CORS 安全的首部字段集合之外的其他首部字段。该集合为：")]),s._v(" "),a("ul",[a("li",[s._v("Accept")]),s._v(" "),a("li",[s._v("Accept-Language")]),s._v(" "),a("li",[s._v("Content-Language")]),s._v(" "),a("li",[s._v("Content-Type")]),s._v(" "),a("li",[s._v("DPR")]),s._v(" "),a("li",[s._v("Downlink")]),s._v(" "),a("li",[s._v("Save-Data")]),s._v(" "),a("li",[s._v("Viewport-Width")]),s._v(" "),a("li",[s._v("Width")]),s._v(" "),a("li",[s._v("Content-Type的值不属于下列之一:")]),s._v(" "),a("li",[s._v("application/x-www-form-urlencoded")]),s._v(" "),a("li",[s._v("multipart/form-data")]),s._v(" "),a("li",[s._v("text/plain")])]),s._v(" "),a("p",[s._v("如下是一个需要执行预检请求的HTTP请求：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("var invocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new XMLHttpRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nvar url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://bar.other/resources/post-here/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nvar body "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<?xml version=\"1.0\"?><person><name>Arun</name></person>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("callOtherDomain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  if"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("invocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      invocation.open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'POST'")]),s._v(", url, "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      invocation.setRequestHeader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-PRODUCT'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'H5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      invocation.setRequestHeader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/xml'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      invocation.onreadystatechange "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" handler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      invocation.send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("上面的代码使用POST请求发送一个XML文档，该请求包含了一个自定义的首部字段（X-PRODUCT:H5）。另外，该请求的Content-Type为application/xml。因此，该请求需要首先发起“预检请求”。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s4.ax1x.com/2022/02/17/H4rJ29.png",alt:"H4rJ29.png"}})]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". OPTIONS /resources/post-here/ \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". Host: bar.other\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(". User-Agent: Mozilla/5.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Macintosh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" U"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".Intel Mac OS X "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" en-US"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" rv:1.9.1b3pre"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Gecko/20081130 Minefield/3.1b3pre\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(". Accept: text/html,application/xhtml+xml,application/xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v(",*/*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(". Accept-Language: en-us,en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(". Accept-Encoding: gzip,deflate\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(". Accept-Charset: ISO-8859-1,utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(",*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(". Connection: keep-alive\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(". Origin: http://foo.example\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(". Access-Control-Request-Method: POST\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(". Access-Control-Request-Headers: X-PINGOTHER, Content-Type\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(". HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(". Date: Mon, 01 Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2008")]),s._v(" 01:15:39 GMT\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(". Server: Apache/2.0.61 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(". Access-Control-Allow-Origin: http://foo.example\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(". Access-Control-Allow-Methods: POST, GET, OPTIONS\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(". Access-Control-Allow-Headers: X-PINGOTHER, Content-Type\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(". Access-Control-Max-Age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(". Vary: Accept-Encoding, Origin\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(". Content-Encoding: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(". Content-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(". Keep-Alive: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(". Connection: Keep-Alive\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(". Content-Type: text/plain\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("从上面的报文中可以看到，第1~12行发送了一个使用OPTIONS方法的预检请求。 OPTIONS是HTTP/1.1协议中定义的方法，用以从服务器获取更多信息。该方法不会对服务器资源产生影响。遇见请求中同时携带了下面两个首部字段：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Access-Control-Request-Method: POST\nAccess-Control-Request-Headers: X-PRODUCT\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("首部字段 Access-Control-Request-Method 告知服务器，实际请求将使用 POST 方法。首部字段 Access-Control-Request-Headers 告知服务器，实际请求将携带两个自定义请求首部字段：X-PINGOTHER 与 Content-Type。服务器据此决定，该实际请求是否被允许。")]),s._v(" "),a("p",[s._v("第14~26行 为预检请求的响应，表明服务器将坚守后续的实际请求。重点看第17~20行：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Access-Control-Allow-Origin: http://foo.example\nAccess-Control-Allow-Methods: POST, GET, OPTIONS\nAccess-Control-Allow-Headers: X-PINGOTHER, Content-Type\nAccess-Control-Max-Age: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("首部字段 Access-Control-Allow-Methods 表明服务器允许客户端使用 POST,GET 和 OPTIONS 方法发起请求。")]),s._v(" "),a("p",[s._v("首部字段Access-Control-Allow-Headers 表明服务器允许请求中携带字段X-PINGOTHER 与Content-Type。与 Access-Control-Allow-Methods一样，Access-Control-Allow-Headers的值为逗号分割的列表。")]),s._v(" "),a("p",[s._v("最后，首部字段")]),s._v(" "),a("p",[s._v("Access-Control-Max-Age 表明该响应的有效时间为 86400 秒，也就是 24 小时。在有效时间内，浏览器无须为同一请求再次发起预检请求。请注意，浏览器自身维护了一个最大有效时间，如果该首部字段的值超过了最大有效时间，将不会生效。")]),s._v(" "),a("p",[s._v("预检请求完成之后，发送实际请求：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("POST /resources/post-here/ HTTP/1.1\nHost: bar.other\nUser-Agent: Mozilla/5.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Macintosh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" U"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Intel Mac OS X "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" en-US"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" rv:1.9.1b3pre"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Gecko/20081130 Minefield/3.1b3pre\nAccept: text/html,application/xhtml+xml,application/xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v(",*/*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8")]),s._v("\nAccept-Language: en-us,en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(",*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("q")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v("\nConnection: keep-alive\nX-PINGOTHER: pingpong\nContent-Type: text/xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-8\nReferer: http://foo.example/examples/preflightInvocation.html\nContent-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("\nOrigin: http://foo.example\nPragma: no-cache\nCache-Control: no-cache\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("?xml "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),s._v("?"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("person"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Arun"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/person"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nDate: Mon, 01 Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2008")]),s._v(" 01:15:40 GMT\nServer: Apache/2.0.61 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nAccess-Control-Allow-Origin: http://foo.example\nVary: Accept-Encoding, Origin\nContent-Encoding: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v("\nContent-Length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("235")]),s._v("\nKeep-Alive: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("\nConnection: Keep-Alive\nContent-Type: text/plain\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Some GZIP'd payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);