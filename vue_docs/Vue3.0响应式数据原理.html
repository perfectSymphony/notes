<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue3.0 响应式数据原理：ES6 Proxy | perfectSymphony</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/notes/home.jpeg">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/notes/assets/css/0.styles.15a5e134.css" as="style"><link rel="preload" href="/notes/assets/js/app.8d477172.js" as="script"><link rel="preload" href="/notes/assets/js/2.c442c8a0.js" as="script"><link rel="preload" href="/notes/assets/js/1.1f1a9053.js" as="script"><link rel="preload" href="/notes/assets/js/145.c694faf8.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.d1870f96.js"><link rel="prefetch" href="/notes/assets/js/100.8e285484.js"><link rel="prefetch" href="/notes/assets/js/101.cc944f9f.js"><link rel="prefetch" href="/notes/assets/js/102.3e2628c0.js"><link rel="prefetch" href="/notes/assets/js/103.68ba1dec.js"><link rel="prefetch" href="/notes/assets/js/104.2efe61b6.js"><link rel="prefetch" href="/notes/assets/js/105.085294c9.js"><link rel="prefetch" href="/notes/assets/js/106.76cd39d2.js"><link rel="prefetch" href="/notes/assets/js/107.e1ffbb31.js"><link rel="prefetch" href="/notes/assets/js/108.d38cb0f5.js"><link rel="prefetch" href="/notes/assets/js/109.af3dbe86.js"><link rel="prefetch" href="/notes/assets/js/11.8d743822.js"><link rel="prefetch" href="/notes/assets/js/110.d7ce36f1.js"><link rel="prefetch" href="/notes/assets/js/111.1885a4e6.js"><link rel="prefetch" href="/notes/assets/js/112.b7eebed2.js"><link rel="prefetch" href="/notes/assets/js/113.3cc428bf.js"><link rel="prefetch" href="/notes/assets/js/114.e43fb283.js"><link rel="prefetch" href="/notes/assets/js/115.0718dd2a.js"><link rel="prefetch" href="/notes/assets/js/116.fa08f926.js"><link rel="prefetch" href="/notes/assets/js/117.c070136e.js"><link rel="prefetch" href="/notes/assets/js/118.87b4bb0a.js"><link rel="prefetch" href="/notes/assets/js/119.e7432b0f.js"><link rel="prefetch" href="/notes/assets/js/12.a1eed2c7.js"><link rel="prefetch" href="/notes/assets/js/120.ed4c0977.js"><link rel="prefetch" href="/notes/assets/js/121.4862c444.js"><link rel="prefetch" href="/notes/assets/js/122.cdd9a0f7.js"><link rel="prefetch" href="/notes/assets/js/123.ee2eb868.js"><link rel="prefetch" href="/notes/assets/js/124.730517ae.js"><link rel="prefetch" href="/notes/assets/js/125.53fd3663.js"><link rel="prefetch" href="/notes/assets/js/126.fffd16bd.js"><link rel="prefetch" href="/notes/assets/js/127.8baf9250.js"><link rel="prefetch" href="/notes/assets/js/128.b7e63689.js"><link rel="prefetch" href="/notes/assets/js/129.6cc9fc42.js"><link rel="prefetch" href="/notes/assets/js/13.f25d8715.js"><link rel="prefetch" href="/notes/assets/js/130.fde69261.js"><link rel="prefetch" href="/notes/assets/js/131.ebcb789c.js"><link rel="prefetch" href="/notes/assets/js/132.1ca963dc.js"><link rel="prefetch" href="/notes/assets/js/133.87651e7c.js"><link rel="prefetch" href="/notes/assets/js/134.858e916c.js"><link rel="prefetch" href="/notes/assets/js/135.d4c917fe.js"><link rel="prefetch" href="/notes/assets/js/136.b44615ea.js"><link rel="prefetch" href="/notes/assets/js/137.a10065f6.js"><link rel="prefetch" href="/notes/assets/js/138.9513018e.js"><link rel="prefetch" href="/notes/assets/js/139.d0181373.js"><link rel="prefetch" href="/notes/assets/js/14.e14b1667.js"><link rel="prefetch" href="/notes/assets/js/140.af625d8c.js"><link rel="prefetch" href="/notes/assets/js/141.d317bf49.js"><link rel="prefetch" href="/notes/assets/js/142.2768b601.js"><link rel="prefetch" href="/notes/assets/js/143.3d66671b.js"><link rel="prefetch" href="/notes/assets/js/144.5a03dcc3.js"><link rel="prefetch" href="/notes/assets/js/146.e3f818cf.js"><link rel="prefetch" href="/notes/assets/js/147.298aad34.js"><link rel="prefetch" href="/notes/assets/js/148.7b2baf7a.js"><link rel="prefetch" href="/notes/assets/js/149.cf0c392f.js"><link rel="prefetch" href="/notes/assets/js/15.b7ac0678.js"><link rel="prefetch" href="/notes/assets/js/150.a6090826.js"><link rel="prefetch" href="/notes/assets/js/151.511c42a0.js"><link rel="prefetch" href="/notes/assets/js/152.13b4fcca.js"><link rel="prefetch" href="/notes/assets/js/153.d07ffab1.js"><link rel="prefetch" href="/notes/assets/js/154.b191c195.js"><link rel="prefetch" href="/notes/assets/js/155.7ac67bb4.js"><link rel="prefetch" href="/notes/assets/js/156.e341e402.js"><link rel="prefetch" href="/notes/assets/js/157.86f93e97.js"><link rel="prefetch" href="/notes/assets/js/158.5bf8ef10.js"><link rel="prefetch" href="/notes/assets/js/159.fb999c14.js"><link rel="prefetch" href="/notes/assets/js/16.df80856b.js"><link rel="prefetch" href="/notes/assets/js/160.9f31f69f.js"><link rel="prefetch" href="/notes/assets/js/161.5288f014.js"><link rel="prefetch" href="/notes/assets/js/17.cbeed63e.js"><link rel="prefetch" href="/notes/assets/js/18.66b6265b.js"><link rel="prefetch" href="/notes/assets/js/19.5dff96c3.js"><link rel="prefetch" href="/notes/assets/js/20.0bba3b6a.js"><link rel="prefetch" href="/notes/assets/js/21.8dca4c41.js"><link rel="prefetch" href="/notes/assets/js/22.5811b0b1.js"><link rel="prefetch" href="/notes/assets/js/23.2ed324fd.js"><link rel="prefetch" href="/notes/assets/js/24.1a7cb162.js"><link rel="prefetch" href="/notes/assets/js/25.ccfb1b09.js"><link rel="prefetch" href="/notes/assets/js/26.0b7aa361.js"><link rel="prefetch" href="/notes/assets/js/27.f5cdf427.js"><link rel="prefetch" href="/notes/assets/js/28.b3840a18.js"><link rel="prefetch" href="/notes/assets/js/29.38a6c880.js"><link rel="prefetch" href="/notes/assets/js/3.594c8c9b.js"><link rel="prefetch" href="/notes/assets/js/30.8f4d5745.js"><link rel="prefetch" href="/notes/assets/js/31.21b6c106.js"><link rel="prefetch" href="/notes/assets/js/32.5cfec57c.js"><link rel="prefetch" href="/notes/assets/js/33.046fe29c.js"><link rel="prefetch" href="/notes/assets/js/34.b267188f.js"><link rel="prefetch" href="/notes/assets/js/35.28fb854d.js"><link rel="prefetch" href="/notes/assets/js/36.a2b32254.js"><link rel="prefetch" href="/notes/assets/js/37.a68309f6.js"><link rel="prefetch" href="/notes/assets/js/38.30d7c879.js"><link rel="prefetch" href="/notes/assets/js/39.11e03058.js"><link rel="prefetch" href="/notes/assets/js/4.dc12ee99.js"><link rel="prefetch" href="/notes/assets/js/40.e2324fa6.js"><link rel="prefetch" href="/notes/assets/js/41.180f0463.js"><link rel="prefetch" href="/notes/assets/js/42.1a68c486.js"><link rel="prefetch" href="/notes/assets/js/43.ca48ff2f.js"><link rel="prefetch" href="/notes/assets/js/44.3e86c7d5.js"><link rel="prefetch" href="/notes/assets/js/45.c7c438aa.js"><link rel="prefetch" href="/notes/assets/js/46.87219280.js"><link rel="prefetch" href="/notes/assets/js/47.774373dc.js"><link rel="prefetch" href="/notes/assets/js/48.d2848e9d.js"><link rel="prefetch" href="/notes/assets/js/49.3997af4b.js"><link rel="prefetch" href="/notes/assets/js/5.c77f2f7b.js"><link rel="prefetch" href="/notes/assets/js/50.65dbf269.js"><link rel="prefetch" href="/notes/assets/js/51.37ae9b6f.js"><link rel="prefetch" href="/notes/assets/js/52.cf9cf254.js"><link rel="prefetch" href="/notes/assets/js/53.28402041.js"><link rel="prefetch" href="/notes/assets/js/54.0b992b1f.js"><link rel="prefetch" href="/notes/assets/js/55.be80b5a3.js"><link rel="prefetch" href="/notes/assets/js/56.95100be7.js"><link rel="prefetch" href="/notes/assets/js/57.a98b58b1.js"><link rel="prefetch" href="/notes/assets/js/58.7cdd592b.js"><link rel="prefetch" href="/notes/assets/js/59.9dfc151c.js"><link rel="prefetch" href="/notes/assets/js/6.dfc98fce.js"><link rel="prefetch" href="/notes/assets/js/60.294b40df.js"><link rel="prefetch" href="/notes/assets/js/61.0ab0a52a.js"><link rel="prefetch" href="/notes/assets/js/62.a38d4d97.js"><link rel="prefetch" href="/notes/assets/js/63.abb0f65b.js"><link rel="prefetch" href="/notes/assets/js/64.802cb5d4.js"><link rel="prefetch" href="/notes/assets/js/65.f8801290.js"><link rel="prefetch" href="/notes/assets/js/66.db262da8.js"><link rel="prefetch" href="/notes/assets/js/67.e1bcaf0d.js"><link rel="prefetch" href="/notes/assets/js/68.8b051947.js"><link rel="prefetch" href="/notes/assets/js/69.992bc9fc.js"><link rel="prefetch" href="/notes/assets/js/7.40d06047.js"><link rel="prefetch" href="/notes/assets/js/70.007be44e.js"><link rel="prefetch" href="/notes/assets/js/71.8eb57a4f.js"><link rel="prefetch" href="/notes/assets/js/72.228788dc.js"><link rel="prefetch" href="/notes/assets/js/73.0669063d.js"><link rel="prefetch" href="/notes/assets/js/74.e19612a8.js"><link rel="prefetch" href="/notes/assets/js/75.44007f2f.js"><link rel="prefetch" href="/notes/assets/js/76.2dd82479.js"><link rel="prefetch" href="/notes/assets/js/77.6629c637.js"><link rel="prefetch" href="/notes/assets/js/78.3b2d6be5.js"><link rel="prefetch" href="/notes/assets/js/79.d39fc26e.js"><link rel="prefetch" href="/notes/assets/js/80.39f56545.js"><link rel="prefetch" href="/notes/assets/js/81.09a64cc4.js"><link rel="prefetch" href="/notes/assets/js/82.ac52a44a.js"><link rel="prefetch" href="/notes/assets/js/83.3f311c91.js"><link rel="prefetch" href="/notes/assets/js/84.5652cbaf.js"><link rel="prefetch" href="/notes/assets/js/85.76ddf082.js"><link rel="prefetch" href="/notes/assets/js/86.0e0b1e25.js"><link rel="prefetch" href="/notes/assets/js/87.2d2d9d1f.js"><link rel="prefetch" href="/notes/assets/js/88.41bd4cdf.js"><link rel="prefetch" href="/notes/assets/js/89.75ec4195.js"><link rel="prefetch" href="/notes/assets/js/90.62dcc3b2.js"><link rel="prefetch" href="/notes/assets/js/91.63649176.js"><link rel="prefetch" href="/notes/assets/js/92.a309e804.js"><link rel="prefetch" href="/notes/assets/js/93.e17e54e6.js"><link rel="prefetch" href="/notes/assets/js/94.2d63689d.js"><link rel="prefetch" href="/notes/assets/js/95.b1e9194d.js"><link rel="prefetch" href="/notes/assets/js/96.f05d4fca.js"><link rel="prefetch" href="/notes/assets/js/97.66a0bb97.js"><link rel="prefetch" href="/notes/assets/js/98.9da424c4.js"><link rel="prefetch" href="/notes/assets/js/99.c097eec4.js"><link rel="prefetch" href="/notes/assets/js/vendors~docsearch.6fed1ae2.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.15a5e134.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">perfectSymphony</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.cnblogs.com/myprogramer/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/notes/css_docs/CSS中的BFC详解.html" class="nav-link">
  算法题库
</a></div> <a href="https://github.com/perfectSymphony/notes.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.cnblogs.com/myprogramer/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/notes/css_docs/CSS中的BFC详解.html" class="nav-link">
  算法题库
</a></div> <a href="https://github.com/perfectSymphony/notes.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/html_docs/html相关面试题.html" class="sidebar-link">html相关面试题</a></li><li><a href="/notes/html_docs/table使用总结.html" class="sidebar-link">table使用总结</a></li><li><a href="/notes/html_docs/localStorage和sessionStorage区别.html" class="sidebar-link">localStorage和sessionStorage区别</a></li><li><a href="/notes/html_docs/meta标签和浏览器缓存关系.html" class="sidebar-link">meta标签和浏览器缓存关系</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/vue_docs/Vue相关面试题.html" class="sidebar-link">Vue相关面试题</a></li><li><a href="/notes/vue_docs/vue中的mixins.html" class="sidebar-link">vue中的mixins</a></li><li><a href="/notes/vue_docs/Vue Router的params和query传参的使用和区别.html" class="sidebar-link">Vue Router的params和query传参的使用和区别</a></li><li><a href="/notes/vue_docs/Vue的computed和watch的细节全面分析.html" class="sidebar-link">Vue的computed和watch的细节全面分析</a></li><li><a href="/notes/vue_docs/vue实现路由按需加载的3种方式.html" class="sidebar-link">vue实现路由按需加载的3种方式</a></li><li><a href="/notes/vue_docs/vue中的router和route的区别.html" class="sidebar-link">vue中的router和route的区别</a></li><li><a href="/notes/vue_docs/从单页应用改造成多页应用.html" class="sidebar-link">从单页应用改造成多页应用</a></li><li><a href="/notes/vue_docs/Vue子组件调用父组件的三种方法.html" class="sidebar-link">Vue子组件调用父组件的三种方法</a></li><li><a href="/notes/vue_docs/Vue的异步更新实现原理.html" class="sidebar-link">Vue的异步更新实现原理</a></li><li><a href="/notes/vue_docs/Vue项目性能优化总结.html" class="sidebar-link">Vue项目性能优化总结</a></li><li><a href="/notes/vue_docs/vue进阶之路-vue3新特性.html" class="sidebar-link">vue进阶之路-vue3新特性</a></li><li><a href="/notes/vue_docs/vue3面试中必问的5个考点.html" class="sidebar-link">vue3面试中必问的5个考点</a></li><li><a href="/notes/vue_docs/Vue3.0响应式数据原理.html" class="active sidebar-link">Vue3.0 响应式数据原理：ES6 Proxy</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/vue_docs/Vue中的watch与computed.html" class="sidebar-link">Vue中的watch与computed</a></li><li><a href="/notes/vue_docs/vue中的this指向.html" class="sidebar-link">vue中的this指向</a></li><li><a href="/notes/vue_docs/Vue2.4中$attrs和$listeners的使用.html" class="sidebar-link">Vue2.4中$attrs和$listeners的使用</a></li><li><a href="/notes/vue_docs/vue与react区别.html" class="sidebar-link">vue与react区别</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>uni-app</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GIT</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>跨域</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>概念篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则表达式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>移动直播</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>问题记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>语录篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>每日反思</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目管理</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="vue3-0-响应式数据原理-es6-proxy"><a href="#vue3-0-响应式数据原理-es6-proxy" class="header-anchor">#</a> Vue3.0 响应式数据原理：ES6 Proxy</h3> <h4 id="摘要"><a href="#摘要" class="header-anchor">#</a> 摘要</h4> <ul><li>JavaScript 中的 <code>proxy</code>是什么？ 能干什么？</li> <li>vue3.0 开始为什么用 <code>proxy</code> 代替<code>object.defineProperty</code></li></ul> <h3 id="proxy-是什么"><a href="#proxy-是什么" class="header-anchor">#</a> proxy 是什么</h3> <h5 id="名词解释"><a href="#名词解释" class="header-anchor">#</a> 名词解释：</h5> <div class="language- extra-class"><pre><code>- proxy 对象用于定义基本操作的自定义行为(如属性查找、赋值、枚举、函数调用等)
- proxy 用于修改某些操作的默认行为，也可以理解为在目标对象之前架设一层拦截，外部所有的访问都必须先通过这层拦截，因此，提供了一种机制，可以对外部的访问进行过滤和修改。
</code></pre></div><h5 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h5> <ul><li><p>const p = new Proxy(target, handler)</p> <ul><li>target: 要使用 Proxy 包装的目标对象（可以是任何类型的对象，包括原生数组，函数，甚至另一个代理）</li> <li>handler: 对该代理对象的各种操作行为处理(为空对象的情况下，基本可以理解为是对第一个参数做的一次浅拷贝)</li></ul></li> <li><p>简而言之：target 就是你想要代理的对象；而 handler 是一个函数对象，其中定义了所有你想替 target 代为管理的操作对象，包含了：</p> <ul><li><ul><li>handler.has(target, prop): in 操作符的捕捉器，拦截HasProperty操作</li></ul></li> <li><ul><li>handler.get(target, prop): 属性读取操作的捕捉器</li></ul></li> <li><ul><li>handler.set(target, prop， value): 属性设置操作的捕捉器</li></ul></li> <li><ul><li>handler.apply(target, object, args): 函数调用操作的捕捉器，拦截函数的调用、call和apply操作</li></ul></li> <li>handler.getPrototypeOf(): Object.getPrototypeOf 方法的捕捉器</li> <li>handler.setPrototypeOf(): Object.setPrototypeOf 方法的捕捉器</li> <li>handler.isExtensible(): Object.isExtensible 方法的捕捉器</li> <li>handler.preventExtensions(): Object.preventExtensions 方法的捕捉器</li> <li>handler.getOwnPropertyDescriptor(): Object.getOwnPropertyDescriptor 方法的捕捉器</li> <li>handler.defineProperty(): Object.defineProperty 方法的捕捉器</li> <li>handler.deleteProperty(): delete 操作符的捕捉器</li> <li>handler.ownKeys(): Object.getOwnPropertyNames 方法和 Object.getOwnPropertySymbols 方法的捕捉器</li> <li>handler.construct(): new 操作符的捕捉器</li></ul></li> <li><p>注意：如果一个属性不可配置 || 不可写，则该属性不可被代理，通过 Proxy 访问该属性会报错。</p></li> <li><ul><li>标记的trap为本文都要涉及到的</li></ul></li></ul> <h5 id="proxy-能干什么"><a href="#proxy-能干什么" class="header-anchor">#</a> proxy 能干什么？</h5> <p>当进行以下操作时proxy模式通常会很有用：
- 拦截或控制对某个对象的访问。
- 通过隐藏事务或者辅助逻辑来减小方法/或者类的复杂性
- 防止在未经验证/准备的情况下执行重度依赖资源的操作</p> <h4 id="一、javascript中真正的私有变量-拦截has-in-操作-给出提示信息或是阻止特定操作"><a href="#一、javascript中真正的私有变量-拦截has-in-操作-给出提示信息或是阻止特定操作" class="header-anchor">#</a> 一、JavaScript中真正的私有变量/拦截has...in...操作/给出提示信息或是阻止特定操作</h4> <h5 id="传统方法私有变量可获取可修改"><a href="#传统方法私有变量可获取可修改" class="header-anchor">#</a> 传统方法私有变量可获取可修改</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">PrivateTar</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'定义公共变量'</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token parameter">secrect</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		_secrectTar <span class="token operator">=</span> secrect<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> _secrectTar
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> privateTar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrivateTar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
privateTar<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'set变量'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>privateTar<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义公共变量</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>privateTar<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;set变量&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>privateTar<span class="token punctuation">.</span>_secrectTar<span class="token punctuation">)</span><span class="token punctuation">;</span> indefined
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="proxy-设置私有变量"><a href="#proxy-设置私有变量" class="header-anchor">#</a> proxy 设置私有变量</h5> <ul><li>针对私有变量，可以使用一个proxy来截获针对某个属性的请求并作出限制或是直接返回 undefined</li> <li>还可以使用 has trap 来掩盖这个属性的存在</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> TargetData <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">_secrectTar</span><span class="token operator">:</span> <span class="token string">'定义私有变量'</span><span class="token punctuation">,</span>
   <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'定义公共变量'</span>
<span class="token punctuation">}</span>
ProxyTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>TargetData<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token comment">// 以下划线开头的是私有变量</span>
   	<span class="token keyword">if</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span><span class="token function">startWidth</span><span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'不能获取私有变量！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   		<span class="token keyword">return</span> <span class="token boolean">false</span>
   	<span class="token punctuation">}</span>
   	<span class="token comment">// 非私有变量，返回原属性值</span>
   	<span class="token keyword">return</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token keyword">if</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span><span class="token function">startWidth</span><span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'不能修改私有变量！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   		<span class="token keyword">return</span> <span class="token boolean">false</span>
   	<span class="token punctuation">}</span>
   	target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token comment">// in操作符的捕捉器</span>
   <span class="token function-variable function">has</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token keyword">return</span> prop<span class="token punctuation">.</span><span class="token function">startWidth</span><span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> target<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

PrivateTarget<span class="token punctuation">.</span>_secrectDrink<span class="token punctuation">;</span> <span class="token comment">// 不能获取私有变量！</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ProxyTarget<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '定义公共变量'</span>
PrivateTarget<span class="token punctuation">.</span>_secrectDrink <span class="token operator">=</span> <span class="token string">'修改私有变量'</span> <span class="token comment">// 不能修改私有变量</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'_secrectDrink'</span> <span class="token keyword">in</span> ProxyTarget<span class="token punctuation">)</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'title'</span> <span class="token keyword">in</span> ProxyTarget<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li><p><code>has</code> 方法拦截的是 <code>hasProperty</code> 操作，不是 <code>hasOwnProperty</code>,所以 <code>has...in</code> 方法不判断一个属性是自身属性还是继承的属性</p></li> <li><p>注意: <code>has...in</code> 可以拦截到，<code>for...in</code> 拦截不到</p></li> <li><p>阻止其他人删除属性，想让调用方法的人知道该方法已经被废弃，或是想阻止其他人修改属性</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> dataStore <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">noDelete</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span>
   <span class="token function-variable function">oldMethod</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token literal-property property">doNotChange</span><span class="token operator">:</span> <span class="token string">'tried or true'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">NODELETE</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'noDelete'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">DEPRECATED</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'oldMethod'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">NOCHANGE</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'doNotChange'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

dataStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>dataStore<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NOCHANGE</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		<span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error! </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is immutable</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NODELETE</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		<span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error! </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> cannot be deleted.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   	<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">DEPRECATED</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">warning! </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is deprecated.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>

   	<span class="token keyword">return</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		<span class="token function">Reflect</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
   	<span class="token punctuation">}</span> <span class="token operator">:</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

dataStore<span class="token punctuation">.</span>doNotChange <span class="token operator">=</span> <span class="token string">'foo'</span> <span class="token comment">// error: doNotChange is immutable</span>
<span class="token keyword">delete</span> dataStore<span class="token punctuation">.</span>noDelete <span class="token comment">// error: noDelete cannot be deleted</span>
dataStore<span class="token punctuation">.</span><span class="token function">oldMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// warning: oldMethod is deprecated</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><ul><li>注意: 要是 Proxy 代理起作用，必须针对 Proxy 的实例进行操作，而不是针对目标对象进行操作</li></ul> <h4 id="数据校验-看代码"><a href="#数据校验-看代码" class="header-anchor">#</a> 数据校验(看代码)</h4> <ul><li>利用Proxy代理简单数据校验</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> ValidTarget <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">phoneNum</span><span class="token operator">:</span> <span class="token string">'17612345678'</span>
<span class="token punctuation">}</span>

ValidTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>ValidTarget<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>prop <span class="token operator">===</span> <span class="token string">'phoneNum'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// 电话号码校验</span>
			<span class="token keyword">let</span> re <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^1[0-9]{10}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cannot set </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.Wrong format.Should be 1xx-xxxx-xxxx</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ValidTarget<span class="token punctuation">.</span>phoneNum <span class="token operator">=</span> <span class="token string">'12312378900'</span> <span class="token comment">// error message</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>校验逻辑直接加在代理处理函数中过于繁重，我们可以把校验模块直接抽离出来，只需要去处理校验的逻辑，代理层面后续不需要改动</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> ValidatorUtil <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">phoneNum</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> re <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^1[0-9]{10}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>re<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cannot set </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.Wrong format.Should be 1xx-xxxx-xxxx</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>		
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

proxyTargetValidUtil <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>ValidatorUtil<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ValidatorUtil<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

proxyTargetValidUtil<span class="token punctuation">.</span>phoneNum <span class="token operator">=</span> <span class="token string">'123123123121'</span> <span class="token comment">// error message</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="三-利用proxy进行记录对象访问"><a href="#三-利用proxy进行记录对象访问" class="header-anchor">#</a> 三：利用proxy进行记录对象访问</h4> <ul><li>针对那些重度依赖资源，执行缓慢或是频繁使用的方法或接口，统计它们的使用或是性能</li> <li>可以记录各种各样的信息而不用修改应用程序的代码或是阻塞代码执行。并且只需要在这些代码的基础上稍事修改就可以记录特性函数的执行性能</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> api <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
   <span class="token function-variable function">getUsers</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> proxy</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   	<span class="token keyword">var</span> value <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
   	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		<span class="token function">logMethodAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
   		<span class="token keyword">return</span> <span class="token function">Reflect</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> target<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

api<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">logMethodAsync</span><span class="token punctuation">(</span><span class="token parameter">timestamp<span class="token punctuation">,</span> method</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">setTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - Logging </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> request asynchronously.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>以上例子就是一个监听函数执行的代理，可以将其进行扩展为打点函数</li> <li>这里面 Proxy 的 trap 为什么使用 get 而不是 apply ? <a href="https://exploringjs.com/es6/ch_proxies.html#_intercepting-method-calls" target="_blank" rel="noopener noreferrer">答案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="四-普通函数与构造函数的兼容"><a href="#四-普通函数与构造函数的兼容" class="header-anchor">#</a> 四：普通函数与构造函数的兼容</h4> <ul><li>构造函数调用没有使用new关键字来调用的话， class对象会直接抛出异常</li> <li>使用<code>proxy</code>进行封装让构造函数也能够直接进行函数调用</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
   <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'constructor'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Test(1,2) // throw an error(非new方式调用报错)</span>
<span class="token keyword">let</span> proxyClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>Test<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token function-variable function">apply</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> thisArg<span class="token punctuation">,</span> argumentsList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   	<span class="token comment">//如果想要禁止使用非new的方式调用函数，直接抛出异常即可</span>
   	<span class="token comment">//throw new Error(`Function ${target.name} cannot be invoked widthout 'new！'`)</span>
   	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token function">target</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token operator">...</span>argumentsList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">proxyClass</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// constructor: 1,2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="五-深层取值判断-看代码"><a href="#五-深层取值判断-看代码" class="header-anchor">#</a> 五：深层取值判断(看代码)</h4> <ul><li>需要解决的几个问题
<ul><li>获取数据进行拦截</li> <li><code>xxx.xxx.xxx...</code>无论 <code>undefined</code> 出现在哪里都不能报错</li> <li><code>Proxy</code> 的 <code>get()</code> 传入的参数必须是对象</li></ul></li> <li>传统方式深层取值繁琐，利用Proxy可以简化不必要代码</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> country <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'BeiJing'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">area</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'haiDian'</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> country <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'BeiJing'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">area</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'haiDian'</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//传统方式</span>
<span class="token keyword">const</span> areaName <span class="token operator">=</span> country<span class="token punctuation">.</span>city 
		<span class="token operator">&amp;&amp;</span> country<span class="token punctuation">.</span>city<span class="token punctuation">.</span>area 
		<span class="token operator">&amp;&amp;</span> country<span class="token punctuation">.</span>city<span class="token punctuation">.</span>area<span class="token punctuation">.</span>name
<span class="token keyword">const</span> areaId <span class="token operator">=</span> country<span class="token punctuation">.</span>provice<span class="token punctuation">.</span>city<span class="token punctuation">.</span>area<span class="token punctuation">.</span>name<span class="token punctuation">;</span>

<span class="token comment">// 利用Proxy get()拦截，实现(要注意的是proxy第一个参数传入的是对象)</span>
<span class="token comment">// 基础版： 利用get()对传入的对象进行拦截</span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   	<span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">{</span>
   		<span class="token keyword">return</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">.</span>provice<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><ul><li><p>但是当 <code>target[prop]</code> 是 <code>undefined</code> 的时候，<code>Proxy get()</code>的入参变成了 <code>undefined</code>，但 <code>Proxy</code> 第一个入参必须为对象</p></li> <li><p>需要对 obj 为 <code>undefined</code> 的时候进行特殊处理，为了能够深层取值，所以使用一个空函数进行设置拦截，利用 <code>apply</code> trap 进行处理</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> country <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'China'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'BeiJing'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">area</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'haiDian'</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">noop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//这里拦截的是noop函数</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>noop<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token comment">// 这里支持返回执行的传入的参数</span>
		<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token punctuation">[</span>arg<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> obj
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">getData</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> country<span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">let</span> res2 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">.</span>city<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Beijing</span>
<span class="token keyword">let</span> res3 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">.</span>city<span class="token punctuation">.</span>name<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>yyy<span class="token punctuation">.</span><span class="token function">zzz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// cannot read property 'yyy' of undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ul><li><p>我们理想中的应该是，如果属性为 <code>undefined</code> 就返回 <code>undefined</code>，但仍要支持访问下级属性，而不是抛出错误</p></li> <li><p>顺着这个思路来的话，很明显当属性为 <code>undefined</code> 的时候也需要用 <code>Proxy</code> 进行特殊处理
所以我们需要一个具有下面特性的 <code>get()</code> 方法</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
	<span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>yyy<span class="token punctuation">.</span><span class="token function">zzz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>这里完全不需要注意 <code>get(undefined).xxx</code> 是否为正确的值，因为想获取值必须要执行才能拿到</li> <li>那么只需要对所有 <code>undefined</code> 后面访问的属性都默认为 <code>undefined</code> 就好了,所以我们需要一个代理了 <code>undefined</code> 后的返回对象</li> <li>同时为了解决无限循环执行的问题，当第一次检测到出现 <code>undefined</code> 的时候，停止执行</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> isFirst <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">noop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> proxyVoid <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isFirst<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 让get 方法第一次接收代理 undefined 的时候不会死循环</span>
		<span class="token keyword">return</span> proxyVoid<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> isFirst<span class="token punctuation">)</span><span class="token punctuation">{</span>
		isFirst <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 注意这里拦截的是noop函数</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>noop<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token comment">// 这里支持返回执行的时候传入参数</span>
		<span class="token function-variable function">apply</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token punctuation">[</span>arg<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> obj <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> arg <span class="token operator">:</span> obj<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
			   obj <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
			   obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token function">getData</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> proxyVoid<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> country<span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">let</span> res2 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">.</span>city<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Beijing</span>
<span class="token keyword">let</span> res3 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">.</span>city<span class="token punctuation">.</span>name<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>yyy<span class="token punctuation">.</span><span class="token function">zzz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="六、日志上报"><a href="#六、日志上报" class="header-anchor">#</a> 六、日志上报</h4> <ul><li><a href="https://www.infoq.cn/article/6eKiic82aQu3uqaYvvfV" target="_blank" rel="noopener noreferrer">腾讯利用Proxy进行日志上报功能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="vue-3-0-的-proxy-object-defineproperty"><a href="#vue-3-0-的-proxy-object-defineproperty" class="header-anchor">#</a> Vue 3.0 的 Proxy &amp; Object.defineProperty</h3> <h4 id="proxy"><a href="#proxy" class="header-anchor">#</a> Proxy</h4> <ul><li><strong>劫持方式:</strong> 代理整个对象，只需做一层代理就可以监听同级结构下的所有属性变化，包括新增属性和删除属性</li> <li><strong>本质</strong>： <code>Proxy</code>本质上属于元编程非破坏性数据劫持，在原对象的基础上进行了功能的衍生而又不影响原对象，符合松耦合高内聚的设计理念</li></ul> <h4 id="object-defineproperty"><a href="#object-defineproperty" class="header-anchor">#</a> Object.defineProperty</h4> <ul><li><p><strong>劫持方式:</strong> 只能劫持对象的属性，不能直接代理对象</p></li> <li><p><strong>流程:</strong> get中进行依赖收集，set数据时通知订阅者更新</p></li> <li><p><strong>存在的问题:</strong> 虽然 Object.defineProperty 通过为属性设置 getter/setter 能够完成数据的响应式，但是它并不算是实现数据的响应式的完美方案，某些情况下需要对其进行修补或者hack，这也是它的缺陷，主要表现在两个方面：</p> <ul><li>无法检测到对象属性的新增或删除</li> <li>不能监听数组的变化</li></ul></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> boy <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Jack'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span>
<span class="token punctuation">}</span>
boy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>boy<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听属性值得变化'</span><span class="token punctuation">,</span>prop<span class="token punctuation">)</span>
		target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value <span class="token operator">+</span> <span class="token string">'&amp;Rose'</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'&amp;Proxy'</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
boy<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jack'</span><span class="token punctuation">;</span> <span class="token comment">//监听到值得变化 name</span>
boy<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'male'</span><span class="token punctuation">;</span> <span class="token comment">//监听到值的变化 sex</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>boy<span class="token punctuation">.</span>sex<span class="token punctuation">)</span> <span class="token comment">// male&amp;Rose&amp;Proxy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="_1-object-defineproperty-无法监听新增加的属性"><a href="#_1-object-defineproperty-无法监听新增加的属性" class="header-anchor">#</a> 1. Object.defineProperty 无法监听新增加的属性</h5> <ul><li>解决方式：提供方法重新手动Observe，需要监听的话使用<code>Vue.set()</code>重新设置添加属性的响应式</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> girl <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Rose'</span><span class="token punctuation">,</span>
   <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
   <span class="token literal-property property">hobbies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'篮球'</span><span class="token punctuation">,</span> <span class="token string">'足球'</span><span class="token punctuation">,</span> <span class="token string">'游泳'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token function">observe</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
   <span class="token comment">//取出所有属性遍历</span>
   Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   	<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   	<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
   	<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到值得变化'</span><span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
   		val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
   	<span class="token punctuation">}</span><span class="token punctuation">,</span>
   	<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   		<span class="token keyword">return</span> val <span class="token operator">+</span> <span class="token string">'&amp;defineProperty'</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

girl<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'RoseRose'</span> <span class="token comment">// 监听到值得变化 RoseRose</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>girl<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// RoseRose&amp;defineProperty</span>
girl<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">'female'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>girl<span class="token punctuation">.</span>sex<span class="token punctuation">)</span> <span class="token comment">// female</span>
<span class="token function">defineReactive</span><span class="token punctuation">(</span>girl<span class="token punctuation">,</span> <span class="token string">'sex'</span><span class="token punctuation">,</span> <span class="token string">'other'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>girl<span class="token punctuation">.</span>sex<span class="token punctuation">)</span> <span class="token comment">//other&amp;defineProperty</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h5 id="_2-object-defineproperty-无法一次性监听对象所有属性-如对象属性的子属性"><a href="#_2-object-defineproperty-无法一次性监听对象所有属性-如对象属性的子属性" class="header-anchor">#</a> 2. Object.defineProperty 无法一次性监听对象所有属性，如对象属性的子属性</h5> <ul><li>解决方式: 通过递归调用来实现子属性响应式</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> girl <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Rose'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">nickName</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'RoseNickName'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
	<span class="token literal-property property">hobbies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'篮球'</span><span class="token punctuation">,</span> <span class="token string">'足球'</span><span class="token punctuation">,</span> <span class="token string">'游泳'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token function">observe</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
	<span class="token comment">//取出所有属性遍历</span>
	Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 递归制造响应式数据</span>
	<span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
	Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">newVal</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到值得变化'</span><span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
			val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> val<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

girl<span class="token punctuation">.</span>nickName<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'RoseNickNameChange'</span><span class="token punctuation">;</span> <span class="token comment">// 监听到值的变化RoseNickNameChange</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>girl<span class="token punctuation">.</span>nickName<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// RoseNickNameChange</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h5 id="_3-object-defineproperty-无法响应数组操作"><a href="#_3-object-defineproperty-无法响应数组操作" class="header-anchor">#</a> 3. Object.defineProperty 无法响应数组操作</h5> <ul><li>解决方式：通过遍历和重写Array数组原型方法操作方法实现，但是也只限制在<code>push/pop/shift/unshift/splice/sort/reverse</code>这七个方法，其他数组方法及数组的使用则无法检测到，也无法监听数组索引的变化和长度的变更</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> girl <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Rose'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">nickName</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'RoseNickName'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
	<span class="token literal-property property">hobbies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'篮球'</span><span class="token punctuation">,</span> <span class="token string">'足球'</span><span class="token punctuation">,</span> <span class="token string">'游泳'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> originalProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token comment">//先克隆一份Array的原型出来</span>
<span class="token keyword">const</span> arrayProto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>originalProto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token string">'push'</span><span class="token punctuation">,</span>
	<span class="token string">'pop'</span><span class="token punctuation">,</span>
	<span class="token string">'shift'</span><span class="token punctuation">,</span>
	<span class="token string">'unshift'</span><span class="token punctuation">,</span>
	<span class="token string">'splice'</span><span class="token punctuation">,</span>
	<span class="token string">'sort'</span><span class="token punctuation">,</span>
	<span class="token string">'reverse'</span>
<span class="token punctuation">]</span>

methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//执行原始操作</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听到方法的执行'</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
		originalProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 如果是数组，重写原型</span>
		<span class="token comment">//data.__prpto__ = arrayProto</span>
		Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> arrayProto<span class="token punctuation">)</span>
		<span class="token comment">// 传入的可能是多维度的，也需要执行响应式</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// 取出所有属性遍历</span>
		Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
	<span class="token comment">//递归制造响应式数据</span>
	Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">newVal</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> val<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>	
<span class="token punctuation">}</span>

<span class="token function">observe</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span>

girl<span class="token punctuation">.</span>hobbies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'健身'</span><span class="token punctuation">)</span> <span class="token comment">// 监听到方法执行 push</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>girl<span class="token punctuation">.</span>hobbies<span class="token punctuation">)</span>  <span class="token comment">// ['篮球', '足球', '游泳']</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h5 id="_4-proxy-拦截方式更多-如-文章开头提到的13种方式-object-defineproperty-只有-get-和-set"><a href="#_4-proxy-拦截方式更多-如-文章开头提到的13种方式-object-defineproperty-只有-get-和-set" class="header-anchor">#</a> 4. Proxy 拦截方式更多(如：文章开头提到的13种方式); Object.defineProperty 只有 get 和 set</h5> <h5 id="_5-proxy-性能问题"><a href="#_5-proxy-性能问题" class="header-anchor">#</a> 5. Proxy 性能问题</h5> <ul><li><code>Proxy</code> 的性能比 <code>Promise</code> 还差</li> <li><code>Proxy</code> 作为新标准，从长远来看，JS 引擎会继续优化 <code>Proxy</code></li> <li><a href="https://thecodebarbarian.com/thoughts-on-es6-proxies-performance" target="_blank" rel="noopener noreferrer">Thoughts on ES6 Proxies Performance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/zmj97/p/10954968.html" target="_blank" rel="noopener noreferrer">Proxy 性能之我见<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h5 id="_6-proxy-兼容性差"><a href="#_6-proxy-兼容性差" class="header-anchor">#</a> 6. Proxy 兼容性差</h5> <ul><li><code>Vue 3.0</code> 中放弃了对于IE的支持(以为<code>Vue 3.0</code>中会对不兼容的浏览器进行向下兼容，但是经过查看资料和源码发现尤大压根没做兼容)</li> <li>目前并没有一个完整支持<code>Proxy</code>所有拦截方法的<code>Polyfill</code>方案，有一个 <code>google</code> 编写的<code>proxy-polyfill</code>也只支持了<code>get/set/apply/construct</code>四种拦截</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/perfectSymphony/notes/edit/master/docs/vue_docs/Vue3.0响应式数据原理.md" target="_blank" rel="noopener noreferrer">在GitHub上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">7/27/2021, 2:36:25 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/vue_docs/vue3面试中必问的5个考点.html" class="prev">
        vue3面试中必问的5个考点
      </a></span> <span class="next"><a href="/notes/vue_docs/Vue中的watch与computed.html">
        Vue中的watch与computed
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div id="goTop" class="hide-cat" data-v-bf92849a></div><canvas id="vuepress-canvas-cursor"></canvas><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 {$site.title}
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="500" class="live2d" style="right:10px;bottom:20px;opacity:0.8;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/notes/assets/js/app.8d477172.js" defer></script><script src="/notes/assets/js/2.c442c8a0.js" defer></script><script src="/notes/assets/js/1.1f1a9053.js" defer></script><script src="/notes/assets/js/145.c694faf8.js" defer></script>
  </body>
</html>
